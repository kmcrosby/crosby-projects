---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const resources = await getCollection('resources');

// Group resources by category
const categories = [...new Set(resources.map(r => r.data.category))];
const resourcesByCategory = categories.reduce((acc, category) => {
  acc[category] = resources.filter(r => r.data.category === category);
  return acc;
}, {} as Record<string, typeof resources>);
---
<BaseLayout title="Resources - Low-Gravity Fluids Lab">
  <section class="page-hero">
    <div class="container">
      <h1>Resources</h1>
    </div>
  </section>
  <section class="section">
    <div class="container">
      <p class="lead text-center">
        Learning materials, documentation, and tools for space sciences research.
      </p>
      
      {resources.length === 0 ? (
        <div class="placeholder-message">
          <h2>Resources Coming Soon</h2>
          <p>
            Resources will be added through the CMS admin interface.
          </p>
          <a href="/crosby-projects/admin/" class="btn">Add Resources via CMS</a>
        </div>
      ) : (
        <div class="resources-container">
          {categories.map((category) => (
            <div class="resource-category">
              <h2>{category}</h2>
              <div class="resources-grid">
                {resourcesByCategory[category].map((resource) => (
                  <div class="resource-card">
                    <h3>{resource.data.title}</h3>
                    <p>{resource.data.description}</p>
                    {resource.data.tags && resource.data.tags.length > 0 && (
                      <div class="resource-tags">
                        {resource.data.tags.map((tag: string) => (
                          <span class="tag">{tag}</span>
                        ))}
                      </div>
                    )}
                    <div class="resource-links">
                      {resource.data.link && (
                        <a href={resource.data.link} target="_blank" rel="noopener noreferrer" class="resource-link">
                          Visit Link →
                        </a>
                      )}
                      {resource.data.file && (
                        <a href={resource.data.file} target="_blank" rel="noopener noreferrer" class="resource-link">
                          Download File →
                        </a>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  </section>
  <style>
    .page-hero {
      background-color: var(--carthage-red);
      color: var(--carthage-white);
      padding: 3rem 0;
      margin-bottom: var(--spacing-xl);
    }
    .page-hero h1 {
      color: var(--carthage-white);
      margin: 0;
    }
    .placeholder-message {
      max-width: 600px;
      margin: var(--spacing-2xl) auto;
      text-align: center;
      padding: var(--spacing-xl);
      background-color: var(--carthage-gray-light);
      border-radius: 8px;
    }
    .placeholder-message h2 {
      color: var(--carthage-red);
      margin-bottom: var(--spacing-md);
    }
    .resources-container {
      margin-top: var(--spacing-xl);
    }
    .resource-category {
      margin-bottom: var(--spacing-2xl);
    }
    .resource-category h2 {
      color: var(--carthage-red);
      border-bottom: 2px solid var(--carthage-red);
      padding-bottom: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }
    .resources-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-lg);
    }
    .resource-card {
      background: var(--carthage-white);
      padding: var(--spacing-lg);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }
    .resource-card h3 {
      color: var(--carthage-gray-dark);
      margin: 0 0 var(--spacing-sm) 0;
      font-size: 1.1rem;
    }
    .resource-card p {
      color: var(--carthage-gray);
      font-size: 0.95rem;
      line-height: 1.5;
      flex-grow: 1;
    }
    .resource-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      margin: var(--spacing-sm) 0;
    }
    .tag {
      font-size: 0.75rem;
      padding: 2px 8px;
      background-color: var(--carthage-gray-light);
      border-radius: 4px;
      color: var(--carthage-gray-dark);
    }
    .resource-links {
      margin-top: var(--spacing-md);
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }
    .resource-link {
      font-size: 0.9rem;
      color: var(--carthage-blue);
      text-decoration: none;
    }
    .resource-link:hover {
      text-decoration: underline;
    }
  </style>
</BaseLayout>
