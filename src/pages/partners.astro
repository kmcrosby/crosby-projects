---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const partners = await getCollection('partners');

// Separate featured and regular partners
const featuredPartners = partners.filter(p => p.data.featured);
const regularPartners = partners.filter(p => !p.data.featured);

// Group by partner type
const partnerTypes = [...new Set(regularPartners.map(p => p.data.partnerType))];
const partnersByType = partnerTypes.reduce((acc, type) => {
  acc[type] = regularPartners.filter(p => p.data.partnerType === type);
  return acc;
}, {} as Record<string, typeof partners>);
---
<BaseLayout title="Partners & Sponsors - Low-Gravity Fluids Lab">
  <section class="page-hero">
    <div class="container">
      <h1>Partners & Sponsors</h1>
    </div>
  </section>
  <section class="section">
    <div class="container">
      <p class="lead text-center">
        Our collaborators in advancing space technology research and education.
      </p>
      
      {partners.length === 0 ? (
        <div class="placeholder-message">
          <h2>Partners Coming Soon</h2>
          <p>
            Partner information will be added through the CMS admin interface.
          </p>
          <a href="/crosby-projects/admin/" class="btn">Add Partners via CMS</a>
        </div>
      ) : (
        <div class="partners-container">
          {featuredPartners.length > 0 && (
            <div class="featured-partners">
              <h2>Featured Partners</h2>
              <div class="featured-grid">
                {featuredPartners.map((partner) => (
                  <div class="featured-card">
                    {partner.data.logo && (
                      <div class="partner-logo">
                        <img src={partner.data.logo} alt={partner.data.name} />
                      </div>
                    )}
                    <div class="partner-info">
                      <h3>{partner.data.name}</h3>
                      <span class="partner-type">{partner.data.partnerType}</span>
                      <p>{partner.data.description}</p>
                      {partner.data.website && (
                        <a href={partner.data.website} target="_blank" rel="noopener noreferrer" class="partner-link">
                          Visit Website →
                        </a>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {partnerTypes.map((type) => (
            <div class="partner-section">
              <h2>{type}s</h2>
              <div class="partners-grid">
                {partnersByType[type].map((partner) => (
                  <div class="partner-card">
                    {partner.data.logo && (
                      <div class="partner-logo-small">
                        <img src={partner.data.logo} alt={partner.data.name} />
                      </div>
                    )}
                    <div class="partner-details">
                      <h3>{partner.data.name}</h3>
                      <p>{partner.data.description}</p>
                      {partner.data.website && (
                        <a href={partner.data.website} target="_blank" rel="noopener noreferrer" class="partner-link">
                          Visit Website →
                        </a>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  </section>
  <style>
    .page-hero {
      background-color: var(--carthage-red);
      color: var(--carthage-white);
      padding: 3rem 0;
      margin-bottom: var(--spacing-xl);
    }
    .page-hero h1 {
      color: var(--carthage-white);
      margin: 0;
    }
    .placeholder-message {
      max-width: 600px;
      margin: var(--spacing-2xl) auto;
      text-align: center;
      padding: var(--spacing-xl);
      background-color: var(--carthage-gray-light);
      border-radius: 8px;
    }
    .placeholder-message h2 {
      color: var(--carthage-red);
      margin-bottom: var(--spacing-md);
    }
    .partners-container {
      margin-top: var(--spacing-xl);
    }
    .featured-partners {
      margin-bottom: var(--spacing-2xl);
    }
    .featured-partners h2, .partner-section h2 {
      color: var(--carthage-red);
      border-bottom: 2px solid var(--carthage-red);
      padding-bottom: var(--spacing-sm);
      margin-bottom: var(--spacing-lg);
    }
    .featured-grid {
      display: grid;
      gap: var(--spacing-xl);
    }
    .featured-card {
      display: grid;
      grid-template-columns: 1fr;
      background: var(--carthage-white);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 2px solid var(--carthage-red);
    }
    @media (min-width: 768px) {
      .featured-card {
        grid-template-columns: 200px 1fr;
      }
    }
    .partner-logo {
      padding: var(--spacing-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--carthage-white);
    }
    .partner-logo img {
      max-width: 150px;
      max-height: 100px;
      object-fit: contain;
    }
    .partner-info {
      padding: var(--spacing-lg);
    }
    .partner-info h3 {
      color: var(--carthage-red);
      margin: 0 0 var(--spacing-xs) 0;
    }
    .partner-type {
      font-size: 0.8rem;
      color: var(--carthage-blue);
      display: block;
      margin-bottom: var(--spacing-sm);
    }
    .partner-info p {
      color: var(--carthage-gray-dark);
      line-height: 1.6;
    }
    .partner-section {
      margin-bottom: var(--spacing-2xl);
    }
    .partners-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-lg);
    }
    .partner-card {
      background: var(--carthage-white);
      border-radius: 8px;
      padding: var(--spacing-lg);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
    }
    .partner-logo-small {
      height: 60px;
      display: flex;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }
    .partner-logo-small img {
      max-height: 60px;
      max-width: 120px;
      object-fit: contain;
    }
    .partner-details h3 {
      color: var(--carthage-gray-dark);
      margin: 0 0 var(--spacing-sm) 0;
      font-size: 1.1rem;
    }
    .partner-details p {
      color: var(--carthage-gray);
      font-size: 0.95rem;
      line-height: 1.5;
      flex-grow: 1;
    }
    .partner-link {
      display: inline-block;
      margin-top: var(--spacing-md);
      color: var(--carthage-blue);
      text-decoration: none;
      font-size: 0.9rem;
    }
    .partner-link:hover {
      text-decoration: underline;
    }
  </style>
</BaseLayout>
